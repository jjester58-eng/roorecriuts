<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weatherford HS Athlete Recruiting Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- STYLES: unchanged -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    header { text-align: center; color: white; margin-bottom: 40px; }
    header h1 { font-size: 2.5rem; margin-bottom: 15px; }
    header img { width: 120px; background: white; padding: 10px; border-radius: 10px; }
    header p { font-size: 1.2rem; }

    .controls {
      max-width: 1200px;
      margin: 0 auto 30px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .controls select, .controls button {
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }

    .controls button {
      border: none;
      font-weight: 600;
    }

    .controls button:first-of-type { background: #667eea; color: white; }
    .controls button:nth-of-type(2) { background: #4caf50; color: white; }

    .profile-grid {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }

    .player-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .player-photo { width: 100%; height: 250px; object-fit: cover; }
    .player-card h3 { padding: 15px 20px 5px; color: #667eea; display: flex; justify-content: space-between; }
    .jersey { background: #764ba2; color: white; padding: 4px 12px; border-radius: 20px; }
    .meta { padding: 5px 20px 15px; color: #666; }

    .links { padding: 15px 20px; border-top: 1px solid #e0e0e0; }
    .links a { color: #667eea; text-decoration: none; font-weight: 600; }

    .loading {
      grid-column: 1 / -1;
      text-align: center;
      color: white;
      font-size: 1.2rem;
      padding: 40px;
    }

    .error {
      grid-column: 1 / -1;
      background: #f44336;
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
  </style>
</head>

<body>

<header>
  <h1>Weatherford High School Athlete Recruiting Board</h1>
  <img src="https://3.files.edl.io/7221/23/08/08/202500-510f7e1a-ff25-44f4-ba9d-afb5b21bbf98.gif">
  <p>Multi-sport athlete profiles for college recruiters</p>
</header>

<section class="controls">
  <label><strong>Class Year:</strong></label>
  <select id="gradSelect"></select>

  <label><strong>Sport:</strong></label>
  <select id="sportSelect">
    <option value="all">All Sports</option>
    <option value="football">Football</option>
    <option value="track">Track & Field</option>
    <option value="powerlifting">Powerlifting</option>
    <option value="baseball">Baseball</option>
    <option value="basketball">Basketball</option>
    <option value="volleyball">Volleyball</option>
    <option value="soccer">Soccer</option>
  </select>

  <button onclick="loadBoard()">Load Athletes</button>
  <button onclick="window.open('https://script.google.com/macros/s/AKfycbwhFXzANdtYL0czn9Yl5ESnAxspV7HfiJ8BJJ1PvW0uDFYYmvimZ2J677OJIn5yCMUf/exec','_blank')">
    Manage Athletes
  </button>
</section>

<div id="athleteContainer" class="profile-grid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyAEriuPZsbFNBVDBAOri94qHh9-duO7FpM",
  authDomain: "roo-recruits.firebaseapp.com",
  projectId: "roo-recruits",
  storageBucket: "roo-recruits.firebasestorage.app",
  messagingSenderId: "727330176313",
  appId: "1:727330176313:web:4f5494ef8b683fb07e7ce8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app, "roorecruits2");

/* Populate Grad Years */
async function loadGradYears() {
  const select = document.getElementById("gradSelect");
  select.innerHTML = "";

  const snap = await getDocs(collection(db, "athletes"));
  const years = new Set();

  snap.forEach(doc => {
    if (doc.data().gradYear) years.add(String(doc.data().gradYear));
  });

  [...years].sort().forEach(y => {
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = `Class of ${y}`;
    select.appendChild(opt);
  });
}

/* Load Board */
window.loadBoard = async function () {
  const gradYear = document.getElementById("gradSelect").value;
  const sport = document.getElementById("sportSelect").value;
  const container = document.getElementById("athleteContainer");

  container.innerHTML = `<div class="loading">Loading athletes...</div>`;

  const athletesSnap = await getDocs(
    query(collection(db, "athletes"), where("gradYear", "==", gradYear))
  );

  const athletes = {};
  athletesSnap.forEach(d => athletes[d.id] = d.data());

  const sportSnap = sport === "all"
    ? await getDocs(collection(db, "athleteSports"))
    : await getDocs(query(collection(db, "athleteSports"), where("sport", "==", sport)));

  const players = [];
  sportSnap.forEach(doc => {
    const s = doc.data();
    const a = athletes[s.athleteId];
    if (a) players.push({ ...a, ...s });
  });

  container.innerHTML = "";
  players.forEach(p => {
    const card = document.createElement("div");
    card.className = "player-card";
    card.innerHTML = `
      <img class="player-photo" src="${p.photoUrl || 'https://via.placeholder.com/300x250'}">
      <h3>${p.name || "Unknown"} <span class="jersey">#${p.jersey || "—"}</span></h3>
      <p class="meta">
        <strong>${p.sport}</strong> • ${p.position}<br>
        ${p.height} • ${p.weight} lbs • GPA ${p.gpa || "—"}
      </p>`;
    container.appendChild(card);
  });
};

/* Boot */
await loadGradYears();
loadBoard();
</script>

</body>
</html>
