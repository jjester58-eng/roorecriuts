<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Roo Recruits</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f4f4f4;
    }

    header {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    select {
      padding: 6px;
      font-size: 14px;
    }

    #coachInfo {
      font-size: 14px;
      margin-left: auto;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .card {
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
    }

    .card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-radius: 4px;
    }

    .card h3 {
      margin: 8px 0 4px;
      font-size: 16px;
    }

    .card p {
      margin: 2px 0;
      font-size: 13px;
    }
  </style>
</head>

<body>

<header>
  <label>
    Class:
    <select id="gradSelect"></select>
  </label>

  <label>
    Sport:
    <select id="sportSelect"></select>
  </label>

  <div id="coachInfo"></div>
</header>

<div id="board"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    query,
    where
  } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  /* ==============================
     FIREBASE CONFIG (roorecruits2)
  ============================== */
  const firebaseConfig = {
    apiKey: "AHh9-duO7FpM",
    authDomain: "roo-recruits.firebaseapp.com",
    projectId: "roo-recruits",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app, "roorecruits2");

  /* ==============================
     DOM
  ============================== */
  const gradSelect = document.getElementById("gradSelect");
  const sportSelect = document.getElementById("sportSelect");
  const board = document.getElementById("board");
  const coachInfo = document.getElementById("coachInfo");

  let allAthletes = [];

  /* ==============================
     INIT
  ============================== */
  init();

  async function init() {
    await loadAthletes();
    buildFilters();
    await loadCoach();
    renderBoard();

    gradSelect.addEventListener("change", onFilterChange);
    sportSelect.addEventListener("change", onFilterChange);
  }

  /* ==============================
     LOAD ALL ATHLETES ONCE
  ============================== */
  async function loadAthletes() {
    const snap = await getDocs(collection(db, "athletes"));
    allAthletes = snap.docs.map(d => d.data());
  }

  /* ==============================
     BUILD DROPDOWNS DYNAMICALLY
  ============================== */
  function buildFilters() {
    const years = [...new Set(allAthletes.map(a => a.gradYear))].sort();
    const sports = [...new Set(allAthletes.map(a => a.sport))].sort();

    gradSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join("");
    sportSelect.innerHTML = sports.map(s => `<option value="${s}">${s}</option>`).join("");
  }

  /* ==============================
     FILTER CHANGE
  ============================== */
  async function onFilterChange() {
    await loadCoach();
    renderBoard();
  }

  /* ==============================
     LOAD COACH BY SPORT
  ============================== */
  async function loadCoach() {
    coachInfo.innerHTML = "";

    const sport = sportSelect.value;
    if (!sport) return;

    const q = query(
      collection(db, "coaches"),
      where("sport", "==", sport)
    );

    const snap = await getDocs(q);
    if (snap.empty) return;

    const coach = snap.docs[0].data();

    coachInfo.innerHTML = `
      <strong>Coach:</strong> ${coach.name}<br>
      <a href="mailto:${coach.email}">${coach.email}</a>
    `;
  }

  /* ==============================
     RENDER ATHLETES
  ============================== */
  function renderBoard() {
    board.innerHTML = "";

    const year = gradSelect.value;
    const sport = sportSelect.value;

    const filtered = allAthletes.filter(a =>
      a.gradYear == year && a.sport == sport
    );

    filtered.forEach(a => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="${a.photoUrl || ""}" onerror="this.style.display='none'">
        <h3>${a.name}</h3>
        <p>${a.position || ""}</p>
        <p>${a.height || ""} / ${a.weight || ""}</p>
      `;

      board.appendChild(card);
    });
  }
</script>

</body>
</html>
