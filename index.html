<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weatherford HS Athlete Recruiting Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }

    h1 {
      margin-bottom: 10px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    select, button {
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
      font-size: 14px;
    }

    th {
      background: #222;
      color: white;
    }

    img {
      max-height: 80px;
      border-radius: 6px;
    }

    .footer {
      margin-top: 15px;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>

  <h1>Weatherford HS Athlete Recruiting Board</h1>

  <div class="controls">
    <select id="gradYear">
      <option value="">All Grad Years</option>
      <option value="2025">2025</option>
      <option value="2026">2026</option>
      <option value="2027">2027</option>
      <option value="2028">2028</option>
    </select>

    <button onclick="loadAthletes()">Load Athletes</button>

    <button onclick="openManage()">Manage Athletes</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Photo</th>
        <th>Name</th>
        <th>Grad</th>
        <th>Position</th>
        <th>Height</th>
        <th>Weight</th>
        <th>Hudl</th>
        <th>Offers</th>
      </tr>
    </thead>
    <tbody id="athleteBody">
      <tr>
        <td colspan="8">Select a grad year and click Load Athletes</td>
      </tr>
    </tbody>
  </table>

  <div class="footer">
    Public recruiting view â€¢ Management restricted to staff
  </div>

<script>
  const WEB_APP_URL =
  "https://script.google.com/macros/s/AKfycbwhFXzANdtYL0czn9Yl5ESnAxspV7HfiJ8BJJ1PvW0uDFYYmvimZ2J677OJIn5yCMUf/exec";

  function escapeHtml(text) {
    if (!text) return "";
    return text.replace(/[&<>"']/g, m =>
      ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[m])
    );
  }

  async function loadAthletes() {
    const grad = document.getElementById("gradYear").value;
    const tbody = document.getElementById("athleteBody");

    tbody.innerHTML = `<tr><td colspan="8">Loading...</td></tr>`;

    try {
      const url = `${WEB_APP_URL}?mode=view&gradYear=${encodeURIComponent(grad)}`;
      const res = await fetch(url);
      const data = await res.json();

      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8">No athletes found</td></tr>`;
        return;
      }

      tbody.innerHTML = "";

      data.forEach(row => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${row.photo ? `<img src="${escapeHtml(row.photo)}">` : ""}</td>
          <td>${escapeHtml(row.name)}</td>
          <td>${escapeHtml(row.gradYear)}</td>
          <td>${escapeHtml(row.position)}</td>
          <td>${escapeHtml(row.height)}</td>
          <td>${escapeHtml(row.weight)}</td>
          <td>${row.hudl ? `<a href="${escapeHtml(row.hudl)}" target="_blank">Hudl</a>` : ""}</td>
          <td>${escapeHtml(row.offers)}</td>
        `;

        tbody.appendChild(tr);
      });

    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="8">Error loading data</td></tr>`;
      console.error(err);
    }
  }

  function openManage() {
    // Apps Script handles auth/password
    window.open(`${WEB_APP_URL}?mode=manage`, "_blank");
  }
</script>

</body>
</html>
